{"version":3,"sources":["../lib/sntools.js"],"names":["SNTools","crypto","window","msCrypto","buf","Uint32Array","getRandomValues","idx","replace","c","r","v","toString","d","Date","getTime","performance","now","uuid","Math","random","floor","html","tmp","document","implementation","createHTMLDocument","body","innerHTML","textContent","innerText","string","type","xmlDoc","DOMParser","parser","parseFromString","ActiveXObject","async","loadXML","data","filename","textFile","makeTextFile","text","Blob","URL","revokeObjectURL","createObjectURL","file","JSON","stringify","link","createElement","setAttribute","href","appendChild","click","removeChild","stripHTML","defaultTagName","loadXMLString","xmlNotes","getElementsByTagName","notes","tags","defaultTag","generateUUID","content_type","content","title","references","findTag","filter","tag","addTag","push","xmlNote","childNodes","nodeValue","created","updatedNodes","updated","length","contentNode","contentXmlString","node","CDATASection","contentXml","contentHTML","strip","note","created_at","moment","toDate","updated_at","setClientUpdatedAt","xmlTags","tagXml","tagName","allItems","concat","itemsData","items","rawNotes","el","contentElement","getElementsByClassName","e","console","log","name","isNaN","date","getDateFromGKeepNote","noteResult","withTitle","regex","dateString","exec","item","appData","files","completion","index","processedData","toLocaleDateString","readNext","reader","FileReader","onload","target","result","lastModified","split","bind","readAsText","Map","tagsMarker","replaceAll","substring","newData","currentTags","noteReference","forEach","has","set","get","Array","from","values"],"mappings":"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","file":"transpiled.js","sourcesContent":["class SNTools {\n\n  generateUUID() {\n    var crypto = window.crypto || window.msCrypto;\n    if(crypto) {\n      var buf = new Uint32Array(4);\n      crypto.getRandomValues(buf);\n      var idx = -1;\n      return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {\n          idx++;\n          var r = (buf[idx>>3] >> ((idx%8)*4))&15;\n          var v = c == 'x' ? r : (r&0x3|0x8);\n          return v.toString(16);\n      });\n    } else {\n      var d = new Date().getTime();\n      if(window.performance && typeof window.performance.now === \"function\"){\n        d += performance.now(); //use high-precision timer if available\n      }\n      var uuid = 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {\n        var r = (d + Math.random()*16)%16 | 0;\n        d = Math.floor(d/16);\n        return (c=='x' ? r : (r&0x3|0x8)).toString(16);\n      });\n      return uuid;\n    }\n  }\n\n  strip(html) {\n     var tmp = document.implementation.createHTMLDocument(\"New\").body;\n     tmp.innerHTML = html;\n     return tmp.textContent || tmp.innerText || \"\";\n  }\n\n  loadXMLString(string, type) {\n    var xmlDoc;\n    if (window.DOMParser) {\n      var parser = new DOMParser();\n      xmlDoc = parser.parseFromString(string, \"text/\" + type);\n    } else {\n      // Internet Explorer\n      xmlDoc = new ActiveXObject(\"Microsoft.XMLDOM\");\n      xmlDoc.async = false;\n      xmlDoc.loadXML(string);\n    }\n\n    return xmlDoc;\n  }\n\n  downloadSNData(data, filename) {\n    var textFile = null;\n    var makeTextFile = function (text) {\n      var data = new Blob([text], {type: 'text/json'});\n\n      // If we are replacing a previously generated file we need to\n      // manually revoke the object URL to avoid memory leaks.\n      if (textFile !== null) {\n        window.URL.revokeObjectURL(textFile);\n      }\n\n      textFile = window.URL.createObjectURL(data);\n\n      // returns a URL you can use as a href\n      return textFile;\n    }\n\n    var file = makeTextFile(JSON.stringify(data, null, 2 /* pretty print */));\n\n    var link = document.createElement('a');\n    link.setAttribute('download', filename);\n    link.href = file;\n    document.body.appendChild(link);\n    link.click();\n    document.body.removeChild(link);\n  }\n\n  convertENEXDatatoSN(data, stripHTML = false, defaultTagName = \"evernote\") {\n    var xmlDoc = this.loadXMLString(data, \"xml\");\n    var xmlNotes = xmlDoc.getElementsByTagName(\"note\");\n    var notes = [];\n    var tags = [];\n    var defaultTag;\n\n    if(defaultTagName) {\n      defaultTag = {\n        uuid: this.generateUUID(),\n        content_type: \"Tag\",\n        content: {\n          title: defaultTagName,\n          references: []\n        }\n      };\n    }\n\n    function findTag(title) {\n      return tags.filter(function(tag){\n        return tag.content.title == title;\n      })[0];\n    }\n\n    function addTag(tag) {\n      tags.push(tag);\n    }\n\n    for(var xmlNote of xmlNotes) {\n      var title = xmlNote.getElementsByTagName(\"title\")[0].childNodes[0].nodeValue;\n      var created = xmlNote.getElementsByTagName(\"created\")[0].childNodes[0].nodeValue;\n      var updatedNodes = xmlNote.getElementsByTagName(\"updated\");\n      var updated = updatedNodes.length ? updatedNodes[0].childNodes[0].nodeValue : null;\n      let contentNode = xmlNote.getElementsByTagName(\"content\")[0];\n      let contentXmlString;\n      /** Find the node with the content */\n      for (let node of contentNode.childNodes) {\n        if (node instanceof CDATASection) {\n          contentXmlString = node.nodeValue;\n          break;\n        }\n      }\n      var contentXml = this.loadXMLString(contentXmlString, \"html\");\n      var contentHTML = contentXml.getElementsByTagName(\"en-note\")[0].innerHTML;\n      if(stripHTML) {\n        contentHTML = contentHTML.replace(/<br[^>]*>/g, \"\\n\\n\");\n        contentHTML = contentHTML.replace(/<li[^>]*>/g, \"\\n\");\n      }\n      var text = stripHTML ? this.strip(contentHTML) : contentHTML;\n\n      var note = {\n        created_at: moment(created).toDate(),\n        updated_at: updated ? moment(updated).toDate() : moment(created).toDate(),\n        uuid: this.generateUUID(),\n        content_type: \"Note\",\n        content: {\n          title: title,\n          text: text,\n          references: [],\n        }\n      };\n\n      this.setClientUpdatedAt(note, note.updated_at);\n\n      if(defaultTag) {\n        defaultTag.content.references.push({\n          content_type: \"Note\",\n          uuid: note.uuid\n        })\n      }\n\n      var xmlTags = xmlNote.getElementsByTagName(\"tag\");\n      for(var tagXml of xmlTags) {\n        var tagName = tagXml.childNodes[0].nodeValue;\n        var tag = findTag(tagName);\n        if(!tag) {\n          tag = {\n            uuid: this.generateUUID(),\n            content_type: \"Tag\",\n            created_at: new Date(),\n            updated_at: new Date(),\n            content: {\n              title: tagName,\n              references: []\n            }\n          }\n          addTag(tag);\n        }\n\n        note.content.references.push({content_type: tag.content_type, uuid: tag.uuid})\n        tag.content.references.push({content_type: note.content_type, uuid: note.uuid})\n      }\n\n      notes.push(note);\n    }\n\n    var allItems = notes.concat(tags);\n    if(defaultTag) {\n      allItems.push(defaultTag);\n    }\n\n    var itemsData = {\n      items: allItems\n    }\n\n    return itemsData;\n  }\n\n  convertGKeepNotes(rawNotes, stripHTML = false) {\n    // Final notes array\n    let notes = [];\n\n    for (let note of rawNotes) {\n      // Parse note html\n      let el = document.createElement('html');\n      el.innerHTML = note.content;\n\n      // Try to get note content\n      let content;\n      try {\n        let contentElement = el.getElementsByClassName('content')[0];\n\n        // Replace <br> with \\n so line breaks get recognised\n        contentElement.innerHTML = contentElement.innerHTML.replace(/<br>/g, \"\\n\");\n\n        // Get note content, removing newline from todo lists\n        if(stripHTML) {\n          content = contentElement.innerText.replace(/☐\\n/g, '☐').replace(/☑\\n/g, '☑');\n        } else {\n          content = contentElement.innerHTML;\n        }\n      } catch(e) {\n        // Invalid note, continue\n        console.log(note.name, \"is an invalid note (no content)\");\n        continue;\n      }\n\n      // Try to get note title\n      let title;\n      try {\n        title = el.getElementsByTagName('title')[0].innerText;\n      } catch(e) {\n        // Invalid note, continue\n        console.log(note.name, \"is an invalid note (no title)\");\n        continue;\n      }\n\n      // Check if title is date (default if no title is set). If so, use empty string\n      if (title !== '' && !isNaN(new Date(title))) {\n        title = '';\n      }\n\n      // Try to find creation date, usually before div.content or div.title\n      const date =\n        this.getDateFromGKeepNote(true, note.content) || \n        this.getDateFromGKeepNote(false, note.content) ||\n        new Date();\n\n      let noteResult = {\n        created_at: date,\n        updated_at: date,\n        uuid: this.generateUUID(),\n        content_type: 'Note',\n        content: {\n          title,\n          text: content,\n          references: [],\n        },\n      }\n\n      this.setClientUpdatedAt(noteResult, date);\n      notes.push(noteResult);\n    }\n    return {\n      \"items\": notes\n    }\n  }\n  getDateFromGKeepNote(withTitle, note) {\n    let regex;\n    if (withTitle) {\n      regex = /.*(?=<\\/div>\\n<div class=\"title\">)/;\n    } else {\n      regex = /.*(?=<\\/div>\\n\\n<div class=\"content\">)/;\n    }\n    const dateString = regex.exec(note);\n    // Check if string exists at all\n    if (dateString && dateString[0]) {\n      // Check if string is valid date\n      if (!isNaN(new Date(dateString))) {\n        return new Date(dateString);\n      }\n    }\n    return false;\n  }\n\n  setClientUpdatedAt(item, date) {\n    item.content.appData = {\n      \"org.standardnotes.sn\": {\n        \"client_updated_at\": date\n      }\n    }\n  }\n\n  convertPlaintextFiles(files, completion) {\n    var index = 0;\n    var processedData = [];\n\n    const dateString = new Date().toLocaleDateString().replace(/\\//g, '-');\n    const defaultTag = {\n      uuid: this.generateUUID(),\n      content_type: \"Tag\",\n      content: {\n        title: `${dateString}-import`,\n        references: []\n      }\n    };\n    processedData.push(defaultTag);\n\n    var readNext = function() {\n      var file = files[index];\n      index++;\n      var reader = new FileReader();\n\n      reader.onload = function(e) {\n        var data = e.target.result;\n        var note = {\n          created_at: new Date(file.lastModified),\n          updated_at: new Date(file.lastModified),\n          uuid: this.generateUUID(),\n          content_type: \"Note\",\n          content: {\n            title: file.name.split(\".\")[0],\n            text: data,\n            references: [],\n          }\n        };\n        this.setClientUpdatedAt(note, note.updated_at);\n        processedData.push(note);\n        defaultTag.content.references.push({\n          content_type: \"Note\",\n          uuid: note.uuid\n        })\n\n        if(index < files.length) {\n          readNext();\n        } else {\n          completion({items: processedData});\n        }\n      }.bind(this)\n      reader.readAsText(file);\n    }.bind(this);\n\n    readNext();\n  }\n\n  convertSimplenoteFiles(files, completion) {\n    var index = 0;\n    var processedData = [];\n\n    var tags = new Map();\n\n    var readNext = function() {\n      var file = files[index];\n      index++;\n      var reader = new FileReader();\n\n      reader.onload = function(e) {\n        var title = file.name.split(\".\")[0];\n\n        var data = e.target.result;\n        var tagsMarker = \"\\nTags:\\n  \";\n        var [newData, currentTags] = (data\n          .replaceAll(\"\\r\\n\", \"\\n\")\n          .substring(title.concat(\"\\n\").length)\n          .split(tagsMarker)\n          );\n\n        currentTags = currentTags ?  currentTags.split(\", \") : [];\n\n        var note = {\n          created_at: new Date(file.lastModified),\n          updated_at: new Date(file.lastModified),\n          uuid: this.generateUUID(),\n          content_type: \"Note\",\n          content: {\n            title: title,\n            text: newData,\n            references: [],\n          }\n        };\n        this.setClientUpdatedAt(note, note.updated_at);\n        processedData.push(note);\n\n        var noteReference = {\n          content_type: \"Note\",\n          uuid: note.uuid,\n        };\n\n        currentTags.forEach(tag => {\n          if (!tags.has(tag)) {\n            tags.set(tag, {\n                uuid: this.generateUUID(),\n                content_type: \"Tag\",\n                content: {\n                  title: tag,\n                  references: [noteReference],\n                }\n            });\n          } else {\n            tags.get(tag).content.references.push(noteReference);\n          }\n\n        });\n\n        if(index < files.length) {\n          readNext();\n        } else {\n          console.log(Array.from(tags.values()));\n          completion({items: Array.from(tags.values()).concat(processedData)});\n        }\n      }.bind(this)\n      reader.readAsText(file);\n    }.bind(this);\n\n    readNext();\n  }\n}\n\nwindow.SNTools = new SNTools()\n"]}